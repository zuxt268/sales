services:
  wix:
    build:
      context: .
    container_name: sales-wix
    env_file:
      - .env
    environment:
      DB_USER: ${DB_USER:-root}
      DB_PASSWORD: ${DB_PASSWORD:-root}
      DB_HOST: db
      DB_PORT: 3306
      DB_NAME: ${DB_NAME:-sales}
      REDIS_HOST: redis
      REDIS_PORT: 6379
      VIEW_DNS_API_URL: ${VIEW_DNS_API_URL}
      API_KEY: ${API_KEY}
    command: ["./wix"]
    networks:
      - sales-network

  crawl:
    build:
      context: .
    container_name: sales-crawl
    env_file:
      - .env
    environment:
      DB_USER: ${DB_USER:-root}
      DB_PASSWORD: ${DB_PASSWORD:-root}
      DB_HOST: db
      DB_PORT: 3306
      DB_NAME: ${DB_NAME:-sales}
      REDIS_HOST: redis
      REDIS_PORT: 6379
    command: ["./crawl"]
    networks:
      - sales-network

  output:
    build:
      context: .
    container_name: sales-output
    env_file:
      - .env
    environment:
      DB_USER: ${DB_USER:-root}
      DB_PASSWORD: ${DB_PASSWORD:-root}
      DB_HOST: db
      DB_PORT: 3306
      DB_NAME: ${DB_NAME:-sales}
      REDIS_HOST: redis
      REDIS_PORT: 6379
      ADDRESS: ${ADDRESS:-:8050}
      VIEW_DNS_API_URL: ${VIEW_DNS_API_URL}
      API_KEY: ${API_KEY}
      PASSWORD: ${PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      SWAGGER_HOST: ${SWAGGER_HOST:-localhost:8050}
      NOTICE_WEB_APP_CHANNEL_URL: ${NOTICE_WEB_APP_CHANNEL_URL}
      GOOGLE_SERVICE_ACCOUNT_PATH: /home/appuser/credentials/service_account.json
      SHEET_ID: ${SHEET_ID}
    command: ["./output"]
    volumes:
      - ./credentials:/app/credentials:ro
    networks:
      - sales-network

networks:
  sales-network:
    external: true